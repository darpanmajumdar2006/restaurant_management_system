import sqlite3

def init_database():
    conn = sqlite3.connect('restaurant.db')
    cursor = conn.cursor()

    # Create tables
    cursor.executescript('''
                         CREATE TABLE CUSTOMER (
    CUSTOMER_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    FIRST_NAME VARCHAR2(50) NOT NULL,
    MIDDLE_GAME VARCHAR2(50),
    LAST_NAME VARCHAR2(50) NOT NULL,
    PHONE VARCHAR2(15) UNIQUE,
    EMAIL VARCHAR2(50) UNIQUE,
    ADDRESS VARCHAR2(100)
);
CREATE TABLE REST_TABLE (
    TABLE_NUMBER NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    BOOKING_ID NUMBER NOT NULL UNIQUE,
    SEATING_CAPACITY NUMBER CHECK(SEATING_CAPACITY>0),
    BOOKING_STATUS VARCHAR2(20) DEFAULT 'AVAILABLE' CHECK (BOOKING_STATUS IN ('AVAILABLE','OCCUPIED','RESERVED')) 
);

CREATE TABLE MENU_ITEM (
  MENUITEM_NUMBER NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  ITEM_NAME VARCHAR2(50) NOT NULL,
  ITEM_CATEGORY VARCHAR2(30),
  PRICE NUMBER(10,2),
  AVAILABILITY_STATUS VARCHAR2(20) DEFAULT 'AVAILABLE'
);
ALTER TABLE MENU_ITEM 
  ADD CONSTRAINT chk_category CHECK (ITEM_CATEGORY IN ('STARTER','MAIN COURSE','DESSERT','BEVERAGE'));
ALTER TABLE MENU_ITEM 
  ADD CONSTRAINT chk_price CHECK (PRICE > 0);
ALTER TABLE MENU_ITEM 
  ADD CONSTRAINT chk_status CHECK (AVAILABILITY_STATUS IN ('AVAILABLE','OUT OF STOCK'));

CREATE TABLE ORDERS (
    ORDER_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CUSTOMER_ID NOT NULL REFERENCES CUSTOMER(CUSTOMER_ID),
    TABLE_NUMBER NUMBER NOT NULL REFERENCES REST_TABLE(TABLE_NUMBER),
    ORDER_DATE DATE DEFAULT SYSDATE,
    ORDER_TIME TIMESTAMP DEFAULT SYSTIMESTAMP,
    TOTAL_AMOUNT NUMBER(10,2),
    ORDER_STATUS VARCHAR2(20) DEFAULT 'PENDING'
);
ALTER TABLE ORDERS 
  ADD CONSTRAINT chk_amount CHECK (TOTAL_AMOUNT > 0);
ALTER TABLE ORDERS
  ADD CONSTRAINT chk_ostatus CHECK (ORDER_STATUS IN ('PENDING','COMPLETED','CANCELLED'));

CREATE TABLE PAYMENT (
    TRANSACTION_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ORDER_ID NUMBER NOT NULL REFERENCES ORDERS(ORDER_ID),
    PAYMENT_DATE DATE DEFAULT SYSDATE,
    PAYMENT_MODE VARCHAR2(20),
    AMOUNT_PAID NUMBER(10,2) 
);
ALTER TABLE PAYMENT
  ADD CONSTRAINT chk_amnt CHECK (AMOUNT_PAID >= 0);
ALTER TABLE PAYMENT
  ADD CONSTRAINT chk_mode CHECK (PAYMENT_MODE IN ('CASH','CARD','UPI'));

CREATE TABLE RESERVATION (
    RESERVATION_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CUSTOMER_ID NUMBER NOT NULL REFERENCES CUSTOMER (CUSTOMER_ID),
    TABLE_NUMBER NOT NULL REFERENCES REST_TABLE(TABLE_NUMBER),
    RESERVATION_DATE DATE NOT NULL,
    RESERVATION_TIME TIMESTAMP NOT NULL,
    NUMBER_OF_PEOPLE NUMBER
);
ALTER TABLE RESERVATION
  ADD CONSTRAINT chk_people CHECK (NUMBER_OF_PEOPLE > 0);

CREATE TABLE ORDER_ITEM (
ORDER_ID NUMBER REFERENCES ORDERS(ORDER_ID),
MENUITEM_NUMBER NUMBER REFERENCES MENU_ITEM(MENUITEM_NUMBER),
QUANTITY NUMBER NOT NULL,
ITEM_TOTAL NUMBER(10,2),
PRIMARY KEY(ORDER_ID,MENUITEM_NUMBER)
);
ALTER TABLE ORDER_ITEM
  ADD CONSTRAINT chk_quantity CHECK (QUANTITY > 0);
ALTER TABLE ORDER_ITEM
  ADD CONSTRAINT chk_total CHECK (ITEM_TOTAL >=0);

CREATE TABLE STAFF (
    STAFF_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    FIRST_NAME VARCHAR2(50) NOT NULL,
    MIDDLE_NAME VARCHAR2(50),
    LAST_NAME VARCHAR2(50) NOT NULL,
    PHONE VARCHAR2(15) UNIQUE,
    EMAIL VARCHAR2(50) UNIQUE,
    ADDRESS VARCHAR2(100),
    STAFF_ROLE VARCHAR2(30) NOT NULL,
    SHIFT_START TIMESTAMP,
    SHIFT_END TIMESTAMP
); 
ALTER TABLE STAFF
  ADD CONSTRAINT chk_role CHECK (sTAFF_ROLE IN ('WAITER','CHEF','MANAGER','CLEANER'));

CREATE TABLE STAFF_ASSIGNMENT (
  STAFF_ID NUMBER REFERENCES STAFF(STAFF_ID),
  ORDER_ID NUMBER REFERENCES ORDERS(ORDER_ID),
  ROLE_IN_ORDER VARCHAR2(30),
  ASSIGNMENT_TIME TIMESTAMP DEFAULT SYSTIMESTAMP,
  PRIMARY KEY (STAFF_ID, ORDER_ID)
);

CREATE INDEX IDX_ORDERS_CUSTOMER ON ORDERS(CUSTOMER_ID);
CREATE INDEX IDX_ORDERS_TABLE ON ORDERS(TABLE_NUMBER);
CREATE INDEX IDX_ORDERITEM_MENU ON ORDER_ITEM(MENUITEM_NUMBER);
CREATE INDEX IDX_PAYMENT_ORDER ON PAYMENT(ORDER_ID);
CREATE INDEX IDX_RESERVATION_CUSTOMER ON RESERVATION(CUSTOMER_ID);
CREATE INDEX IDX_RESERVATION_TABLE ON RESERVATION(TABLE_NUMBER);
''')

    conn.commit()
    conn.close()

if __name__ == "__main__":
    init_database()
